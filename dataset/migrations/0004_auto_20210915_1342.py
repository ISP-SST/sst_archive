# Generated by Django 3.2.6 on 2021-09-15 13:42

from django.db import migrations, models
import django.db.models.deletion


def update_instrument_content_type(apps, schema_editor):
    DataLocation = apps.get_model('dataset', 'DataLocation')
    Instrument = apps.get_model('dataset', 'Instrument')

    for inst in Instrument.objects.all():
        reference = DataLocation.objects.filter(instrument__exact=inst)[0]
        inst.metadata_content_type = reference.metadata_content_type
        inst.save()


class Migration(migrations.Migration):

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        ('dataset', '0003_auto_20210915_1234'),
    ]

    operations = [
        migrations.AddField(
            model_name='instrument',
            name='metadata_content_type',
            field=models.OneToOneField(blank=True, help_text='The model for this instrument metadata', limit_choices_to=models.Q(('app_label', 'metadata'), models.Q(('model', 'tag'), _negated=True)), null=True, on_delete=django.db.models.deletion.SET_NULL, to='contenttypes.contenttype'),
        ),
        migrations.RunPython(update_instrument_content_type),
        migrations.AlterField(
            model_name='datalocation',
            name='instrument',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to='dataset.instrument'),
        ),
        migrations.RemoveField(
            model_name='datalocation',
            name='metadata_content_type',
        ),
    ]
