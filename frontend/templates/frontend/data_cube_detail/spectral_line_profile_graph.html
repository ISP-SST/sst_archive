<div id="spectral-line-profile-chart"></div>

{% autoescape off %}
<script>

window.addEventListener('load', function() {
    const jsonData = {{ spectral_line_data }};
    const jsonVersion = {{ spectral_line_data_version }};

    if (!jsonData || !jsonVersion) {
        return;
    }

    const amplitudeData = [];
    const wavelengths = jsonData['wavelengths'];

    let logged = false;

    const seriesData = [];

    if (jsonVersion === 1) {
        for (let amplitudeValues of jsonData['amplitude_values']) {
            const data = [];

            for (let j = 0; j < amplitudeValues.length; j++) {
                data.push([ wavelengths[j], amplitudeValues[j] ]);
            }

            const series = {
              name: 'Scan',
              type: 'line',
              data: data
            };

            seriesData.push(series);
        }
    } else if (jsonVersion === 2) {
        const data = [];

        const amplitudeValues = jsonData['amplitude_values'];

        for (let i = 0; i < amplitudeValues.length; i++) {
            data.push([ wavelengths[i], amplitudeValues[i] ]);
        }

        const series = {
            name: 'Scan',
            type: 'line',
            data: data
        };

        seriesData.push(series);
    }

    var options = {
      chart: {
        width: '100%',
        height: '300px',
        animations: {
          enabled: false,
        },
        type: 'scatter'
      },
      series: seriesData,
      markers: {
        size: [5],
        strokeColors: '#ff0000',
        fillOpacity: 0,
        strokeWidth: 2,
      },
      xaxis: {
        type: 'numeric',
        decimalsInFloat: 2,
        title: {
          text: 'Wavelength (nm)',
          style: {
              fontSize: '12px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              fontWeight: 600,
              cssClass: 'apexcharts-yaxis-title',
          },
        },
      },
      yaxis: [{
        forceNiceScale: true,
        decimalsInFloat: 2,
        title: {
          text: 'TODO',
          style: {
              color: undefined,
              fontSize: '12px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              fontWeight: 600,
              cssClass: 'apexcharts-yaxis-title',
          },
        },
      }],
      grid: {
        show: true,
        strokeDashArray: [4, 4],
        position: 'back',
        xaxis: {
            lines: {
                show: true
            }
        },
      },
      stroke: {
        width: [1],
      },
      legend: {
        show: false,
      },
      tooltip: {
        enabled: false,
        shared: false
      }
    }

    var chart = new ApexCharts(document.querySelector("#spectral-line-profile-chart"), options);
    chart.render();
});

</script>
{% endautoescape %}
