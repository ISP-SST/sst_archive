<div id="r0-chart"></div>

{% autoescape off %}
<script>
(function() {
    const jsonData = {{ r0_json_data }};
    const jsonVersion = {{ r0_json_version }};

    if (!jsonData) {
        return;
    }

    let dataLow = [];
    let dataLowHigh = [];

    let logged = false;

    if (jsonVersion === 1) {
        for (let i = 0; i < jsonData['r0_timestamps'].length; i++) {
            dataLow.push([ jsonData['r0_timestamps'][i], jsonData['r0_0'][i] ]);
            dataLowHigh.push([ jsonData['r0_timestamps'][i], jsonData['r0_1'][i] ]);
        }
    } else if (jsonVersion >= 2) {
        dataLow = jsonData['r0_low'];
        dataLowHigh = jsonData['r0_low_high'];
    }

    dateBeg = [];
    dateEnd = [];
    scans = jsonData['scannum'];

    if (jsonVersion === 3) {
        for (let date of jsonData['date_beg']) {
            dateBeg.push([date, 0.01]);
        }

        for (let date of jsonData['date_end']) {
            dateEnd.push([date, 0.01]);
        }
    }

    var options = {
      colors: ['#00aa00', '#000000', '#4477ff', '#ff4477'],
      chart: {
        width: '100%',
        height: '300px',
        animations: {
          enabled: false,
        }
      },
      series: [{
          name: 'Low Altitude Seeing',
          type: 'line',
          data: dataLow
        },{
          name: 'Low + High Altitude Seeing',
          type: 'line',
          data: dataLowHigh
        },{
          name: 'Scan Began',
          type: 'scatter',
          data: dateBeg
      }, {
          name: 'Scan Ended',
          type: 'scatter',
          data: dateEnd
      }],
      markers: {
        size: [0, 0, 4, 4]
      },
      xaxis: {
        type: 'datetime',
        title: {
          text: 'Time',
          style: {
              fontSize: '12px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              fontWeight: 600,
              cssClass: 'apexcharts-yaxis-title',
          },
        },
      },
      yaxis: [{
        tickAmount: 5,
        min: 0.00,
        max: 0.25,
        forceNiceScale: true,
        decimalsInFloat: 2,
        title: {
          text: 'r0 (m)',
          style: {
              color: undefined,
              fontSize: '12px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              fontWeight: 600,
              cssClass: 'apexcharts-yaxis-title',
          },
        },
      }],
      grid: {
        show: true,
        strokeDashArray: [4, 4],
        position: 'back',
        xaxis: {
            lines: {
                show: true
            }
        },
      },
      stroke: {
        width: [2, 2]
      },
      tooltip: {
        x: {
          format: "HH:mm:ss.fff",
        },
        custom: function({ series, seriesIndex, dataPointIndex, w }) {
          if (!logged) {
            console.log(w.globals);
            logged = true;
          }

          if (w.globals.seriesNames[seriesIndex] === 'Scan Began' ||
              w.globals.seriesNames[seriesIndex] === 'Scan Ended') {
            return (
              '<div style="background: rgba(0, 0, 0, 0.6); color: #f0f0f0; padding: 0.3em 0.5em;" class="">' +
              w.globals.seriesNames[seriesIndex] + ': ' + scans[dataPointIndex] +
              '</div>');
          }

          return (
            '<div style="background: rgba(0, 0, 0, 0.6); color: #f0f0f0; padding: 0.3em 0.5em; ">' +
            '<span style="display: inline-block; margin-right: 0.3em; background: ' + w.globals.colors[seriesIndex] + '; border: 1px solid #fff; border-radius: 5px; width: 10px; height: 10px"></span>' +
            w.globals.seriesNames[seriesIndex] +
            ": " +
            series[seriesIndex][dataPointIndex].toFixed(5) +
            "</div>"
          );
        }
      }
    }

    var chart = new ApexCharts(document.querySelector("#r0-chart"), options);
    chart.render();
})();

</script>
{% endautoescape %}
